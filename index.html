<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>COVID-19 STATS</title>
    <link rel="shortcut icon" href="favicon.png" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
<body onselectstart="return false" onselect="return false" oncopy="return false">

  <h1>Statystyka dotycząca korona wirusa w Polsce</h1>
  <div class="latest"></div>
  <div class="DescriptionBox">
    <div class="table">
      <table>
        <tr class="tableHeader">
          <th>Data</th>
          <th class="tableConfirmed">Zakażeni</th>
          <th class="tableRecovered">Wyleczeni</th>
          <th class="tableDead">Zgony</th>
        </tr>
       </table>
      </div>
      <div class="chart">
        <canvas id="myChart" ></canvas>
        </div>
  </div>

<script>
   fetch("https://pomber.github.io/covid19/timeseries.json").then(res=>res.json()).then(res=>{
    const { date, confirmed, deaths, recovered } = res.Poland[res.Poland.length - 1];
    const differenceC = res.Poland[res.Poland.length - 1].confirmed - res.Poland[res.Poland.length - 2].confirmed;
    const differenceR = res.Poland[res.Poland.length - 1].recovered - res.Poland[res.Poland.length - 2].recovered;
    const differenceD = res.Poland[res.Poland.length - 1].deaths - res.Poland[res.Poland.length - 2].deaths;
    
    let span=document.querySelector(".latest")
    span.innerHTML+=` <div class="dateDiv"> Stan na dzień: <span class="date">${date}</span> </div>
      <div class="todayBox todayConfirmedBox">
          Zakażeni
          <div class="todayInfo todayConfirmedInfo">
            ${confirmed} (+${differenceC})
          </div>
      </div>
      <div class="todayBox todayRecoveredBox">
          Wyleczeni
          <div class="todayInfo todayRecoveredInfo">
            ${recovered} (+${differenceR})
          </div>
      </div>
      <div class="todayBox todayDeadBox">
          Zgony
          <div class="todayInfo todayDeadInfo">
            ${deaths} (+${differenceD})
          </div>
      </div>
      `;
    


    
  

    const data = {
       date: [],
       confirmed: [],
       recovered: [],
       deaths: []
     }

    res["Poland"].forEach(({ date, confirmed, recovered, deaths }) =>{
    data.date.push(date)
    data.confirmed.push(confirmed)
    data.recovered.push(recovered)
    data.deaths.push(deaths)
    });


     let ctx = document.getElementById('myChart').getContext('2d'); 
      
     let chart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: [...data.date],
              datasets: [{
                  label: 'Zakażeni',
                  borderColor: '#00B2FF',
                  data: [...data.confirmed],
                  borderWidth:'3',
                  pointRadius:'false',
              },
              {
                  label: 'Wyleczeni',
                  borderColor: '#00FF85',
                  data: [...data.recovered],
                  borderWidth:'3',
                  pointRadius:'false',
              },
              {
                  label: 'Zgony',
                  borderColor: '#FF003D',
                  data: [...data.deaths],
                  borderWidth:'3',
                  pointRadius:'false',
              }]
          },
          // Configuration options go here https://www.chartjs.org/docs/latest/general/interactions/events.html
          options: {

            legend: {
            display: false,
            },
          
            maintainAspectRatio:false,
          }
      });
      
      function myFunction(x) {
        if (x.matches) { // If media query matches
          chart.canvas.parentNode.style.width = '90vw';
          chart.canvas.parentNode.style.height = '35vh';
       } else {
        chart.canvas.parentNode.style.width = '50vw';
          chart.canvas.parentNode.style.height = '35vh';
        }
      }

      var x = window.matchMedia("(max-width: 600px)")
      myFunction(x) // Call listener function at run time
      x.addListener(myFunction) // Attach listener function on state changes

     
  }
)



fetch("https://pomber.github.io/covid19/timeseries.json").then(res=>res.json()).then(res=>{
let table=document.querySelector("table")
      res["Poland"].forEach(({ date, confirmed, recovered, deaths }) =>{

    const temp = res["Poland"].reverse();
    temp.forEach((e, i) => {
      let difference = {
        confirmed: temp[i].confirmed - temp[i + 1].confirmed,
        recovered: temp[i].recovered - temp[i + 1].recovered,
        deaths: temp[i].deaths - temp[i + 1].deaths
      }
      let confirmedDiff = temp[i].confirmed - temp[i + 1].confirmed;
      let table = document.querySelector("table");
      table.innerHTML += `<tr>
    <td> ${e.date} </td>
    <td> ${e.confirmed} (+${difference.confirmed})</td>
    <td> ${e.recovered} (+${difference.recovered})</td>
    <td> ${e.deaths} (+${difference.deaths})</td>
    </tr>`;
    });
    
  });

}
)
</script>

</body>
</html>